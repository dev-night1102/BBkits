import{x as y,r as b,j as e,Q as v,t as N,V as o}from"./app-CTIHKyhf.js";import{A as k}from"./AuthenticatedLayout-BO53_2IE.js";import"./transition-CDh67xhH.js";function A({materials:d}){const{data:u,setData:c,post:p,processing:m}=y({reference:"",adjustments:[]}),[r,l]=b.useState([]),g=s=>{const t=d.find(a=>a.id==s);if(!t||r.some(a=>a.id==s))return;const n={id:t.id,name:t.name,reference:t.reference,unit:t.unit,current_stock:t.current_stock,quantity:"",type:"adjustment",notes:"",unit_cost:""};l([...r,n])},h=s=>{l(r.filter(t=>t.id!==s))},i=(s,t,n)=>{l(r.map(a=>a.id===s?{...a,[t]:n}:a))},j=s=>{s.preventDefault();const t=r.filter(n=>n.quantity&&n.quantity!=="0").map(n=>({material_id:n.id,quantity:parseFloat(n.quantity),type:n.type,notes:n.notes,unit_cost:n.unit_cost?parseFloat(n.unit_cost):null}));if(t.length===0){o.error("Adicione pelo menos um material com quantidade válida");return}c("adjustments",t),p(route("admin.inventory.bulk.process"),{data:{reference:u.reference,adjustments:t},onSuccess:()=>{o.success("Ajustes processados com sucesso!"),l([]),c("reference","")},onError:n=>{Object.keys(n).forEach(a=>{o.error(n[a])})}})},x=(s,t)=>Number(s).toLocaleString("pt-BR",{minimumFractionDigits:3})+" "+t,f=s=>{if(!s.quantity)return null;const t=parseFloat(s.quantity);if(isNaN(t))return null;let n=t;s.type==="consumption"&&t>0&&(n=-t);const a=s.current_stock+n;return{change:(n>=0?"+":"")+n.toLocaleString("pt-BR",{minimumFractionDigits:3}),newStock:a.toLocaleString("pt-BR",{minimumFractionDigits:3}),isValid:s.type!=="consumption"||Math.abs(n)<=s.current_stock}};return e.jsxs(k,{header:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Ajuste de Estoque em Lote"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Processe múltiplos ajustes de estoque simultaneamente"})]}),children:[e.jsx(v,{title:"Ajuste de Estoque em Lote"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("form",{onSubmit:j,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Referência Global (Opcional)"}),e.jsx("input",{type:"text",value:u.reference,onChange:s=>c("reference",s.target.value),className:"w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500",placeholder:"Ex: Inventário 2025-01, NF 12345"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Esta referência será aplicada a todos os ajustes"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adicionar Material"}),e.jsxs("select",{onChange:s=>{s.target.value&&(g(s.target.value),s.target.value="")},className:"w-full rounded-lg border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"Selecione um material para adicionar"}),d.filter(s=>!r.some(t=>t.id===s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.reference," - ",s.name," (Estoque: ",x(s.current_stock,s.unit),")"]},s.id))]})]}),r.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Materiais Selecionados (",r.length,")"]}),e.jsx("div",{className:"space-y-4",children:r.map(s=>{const t=f(s);return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 items-start",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Ref: ",s.reference]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Estoque: ",x(s.current_stock,s.unit)]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:s.type,onChange:n=>i(s.id,"type",n.target.value),className:"w-full text-sm rounded-md border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:[e.jsx("option",{value:"purchase",children:"Compra"}),e.jsx("option",{value:"consumption",children:"Consumo"}),e.jsx("option",{value:"adjustment",children:"Ajuste"}),e.jsx("option",{value:"return",children:"Devolução"})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:s.quantity,onChange:n=>i(s.id,"quantity",n.target.value),className:`w-full text-sm rounded-md border-gray-300 focus:border-purple-500 focus:ring-purple-500 ${t&&!t.isValid?"border-red-500":""}`,placeholder:"0.000"}),t&&!t.isValid&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Estoque insuficiente"})]}),s.type==="purchase"&&e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_cost,onChange:n=>i(s.id,"unit_cost",n.target.value),className:"w-full text-sm rounded-md border-gray-300 focus:border-purple-500 focus:ring-purple-500",placeholder:"0.00"})]}),e.jsxs("div",{className:s.type==="purchase"?"lg:col-span-2":"lg:col-span-3",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("input",{type:"text",value:s.notes,onChange:n=>i(s.id,"notes",n.target.value),className:"w-full text-sm rounded-md border-gray-300 focus:border-purple-500 focus:ring-purple-500",placeholder:"Observações..."})]}),e.jsxs("div",{className:"lg:col-span-2 flex items-center justify-between",children:[t&&e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:`font-medium ${t.isValid?"text-green-600":"text-red-600"}`,children:[t.change," ",s.unit]}),e.jsxs("div",{className:"text-gray-500",children:["→ ",t.newStock," ",s.unit]})]}),e.jsx("button",{type:"button",onClick:()=>h(s.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Remover"})]})]})},s.id)})})]}),r.length>0&&e.jsxs("div",{className:"mb-6 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Resumo"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[r.length," materiais selecionados"]}),e.jsxs("p",{children:[r.filter(s=>s.quantity&&s.quantity!=="0").length," com ajustes válidos"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e.jsx(N,{href:route("admin.inventory.index"),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:m||r.length===0,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:m?"Processando...":"Processar Ajustes"})]})]})})})})]})}export{A as default};
