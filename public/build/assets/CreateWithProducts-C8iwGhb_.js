import{r as v,x as R,j as e,Q as q}from"./app-vPGu1-Ks.js";import{A as E}from"./AuthenticatedLayout-CrgCo1hI.js";import{P as O}from"./PrimaryButton-D4gQ01q3.js";import{S as A}from"./SecondaryButton-pxnTL1KY.js";import{T as c}from"./TextInput-DuTBkNcH.js";import{I as o}from"./InputLabel-r4lZfIN_.js";/* empty css            */import"./transition-B1a7D--F.js";function Q({auth:p,clients:g=[],products:b=[]}){const[r,m]=v.useState([]),[u,y]=v.useState({fonts:[],colors:[],positions:[]}),{data:x,setData:h,post:f,processing:N,errors:n}=R({client_id:"",sale_type:"product",total_amount:0,notes:"",products:[]});v.useEffect(()=>{(async()=>{try{const[a,t,d]=await Promise.all([fetch("/api/embroidery/fonts"),fetch("/api/embroidery/colors"),fetch("/api/embroidery/positions")]);y({fonts:await a.json(),colors:await t.json(),positions:await d.json()})}catch(a){console.error("Error loading embroidery options:",a)}})()},[]);const w=()=>{const s={id:Date.now(),product_id:"",quantity:1,unit_price:0,size:"",color:"",embroidery:{text:"",font_id:"",color_id:"",position:""}};m([...r,s]),j([...r,s])},_=s=>{const a=r.filter(t=>t.id!==s);m(a),j(a)},i=(s,a,t)=>{const d=r.map(l=>{if(l.id===s)if(a.startsWith("embroidery.")){const S=a.replace("embroidery.","");return{...l,embroidery:{...l.embroidery,[S]:t}}}else return{...l,[a]:t};return l});m(d),j(d)},j=s=>{const a=s.reduce((t,d)=>t+d.quantity*d.unit_price,0);h(t=>({...t,products:s,total_amount:a}))},P=()=>b.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - R$ ",parseFloat(s.price).toFixed(2)]},s.id)),C=s=>{const a=b.find(t=>t.id==s);return a?parseFloat(a.price):0},k=(s,a)=>{const t=C(a);i(s,"product_id",a),i(s,"unit_price",t)},F=s=>{s.preventDefault(),f("/admin/sales/with-products")};return e.jsxs(E,{user:p.user,header:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Nova Venda - Com Produtos"})}),children:[e.jsx(q,{title:"Nova Venda - Com Produtos"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("form",{onSubmit:F,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(o,{value:"Cliente"}),e.jsxs("select",{value:x.client_id,onChange:s=>h("client_id",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um cliente"}),g.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.phone]},s.id))]}),n.client_id&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:n.client_id})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Produtos"}),e.jsx("button",{type:"button",onClick:w,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"+ Adicionar Produto"})]}),r.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("h4",{className:"font-medium",children:["Produto #",a+1]}),e.jsx("button",{type:"button",onClick:()=>_(s.id),className:"text-red-600 hover:text-red-900",children:"Remover"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Produto"}),e.jsxs("select",{value:s.product_id,onChange:t=>k(s.id,t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um produto"}),P()]})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Quantidade"}),e.jsx(c,{type:"number",min:"1",value:s.quantity,onChange:t=>i(s.id,"quantity",parseInt(t.target.value)||1),className:"mt-1 block w-full",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Tamanho"}),e.jsx(c,{value:s.size,onChange:t=>i(s.id,"size",t.target.value),className:"mt-1 block w-full",placeholder:"P, M, G, GG..."})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Cor do Produto"}),e.jsx(c,{value:s.color,onChange:t=>i(s.id,"color",t.target.value),className:"mt-1 block w-full",placeholder:"Azul, Vermelho..."})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h5",{className:"font-medium mb-3",children:"Bordado (opcional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Texto para Bordar"}),e.jsx(c,{value:s.embroidery.text,onChange:t=>i(s.id,"embroidery.text",t.target.value),className:"mt-1 block w-full",placeholder:"Texto do bordado"})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Fonte"}),e.jsxs("select",{value:s.embroidery.font_id,onChange:t=>i(s.id,"embroidery.font_id",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",children:[e.jsx("option",{value:"",children:"Selecione uma fonte"}),u.fonts.map(t=>e.jsxs("option",{value:t.id,children:[t.display_name," (+R$ ",parseFloat(t.additional_cost).toFixed(2),")"]},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Cor do Bordado"}),e.jsxs("select",{value:s.embroidery.color_id,onChange:t=>i(s.id,"embroidery.color_id",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",children:[e.jsx("option",{value:"",children:"Selecione uma cor"}),u.colors.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (+R$ ",parseFloat(t.additional_cost).toFixed(2),")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Posição"}),e.jsxs("select",{value:s.embroidery.position,onChange:t=>i(s.id,"embroidery.position",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",children:[e.jsx("option",{value:"",children:"Selecione uma posição"}),u.positions.map(t=>e.jsxs("option",{value:t.name,children:[t.display_name," (+R$ ",parseFloat(t.additional_cost).toFixed(2),")"]},t.id))]})]})]})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsxs("span",{className:"font-medium",children:["Subtotal: R$ ",(s.quantity*s.unit_price).toFixed(2)]})})]},s.id)),r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'Nenhum produto adicionado. Clique em "Adicionar Produto" para começar.'})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(o,{value:"Observações"}),e.jsx("textarea",{value:x.notes,onChange:s=>h("notes",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",rows:"3",placeholder:"Observações sobre a venda..."}),n.notes&&e.jsx("div",{className:"text-red-600 text-sm mt-1",children:n.notes})]}),e.jsx("div",{className:"mb-6 text-right",children:e.jsxs("div",{className:"text-2xl font-bold",children:["Total: R$ ",x.total_amount.toFixed(2)]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(A,{onClick:()=>window.history.back(),children:"Cancelar"}),e.jsx(O,{type:"submit",disabled:N||r.length===0,children:"Criar Venda"})]})]})})})})]})}export{Q as default};
