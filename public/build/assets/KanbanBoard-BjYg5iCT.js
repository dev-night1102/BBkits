import{r as c,j as r,Q as E,S as m,V as p}from"./app-CwPJ0y0p.js";import{A as $}from"./AuthenticatedLayout-BQUoIu-t.js";import"./transition-DvZfQSb_.js";function z({sales:u=[],users:S=[]}){const[s,d]=c.useState(null),[l,g]=c.useState({}),[v,x]=c.useState(!1),b={pending_payment:{title:"⏳ Aguardando Pagamento",color:"yellow",bgColor:"bg-yellow-50",borderColor:"border-yellow-200"},payment_approved:{title:"✅ Pagamento Aprovado",color:"green",bgColor:"bg-green-50",borderColor:"border-green-200"},in_production:{title:"🏭 Em Produção",color:"blue",bgColor:"bg-blue-50",borderColor:"border-blue-200"},photo_sent:{title:"📸 Foto Enviada",color:"purple",bgColor:"bg-purple-50",borderColor:"border-purple-200"},photo_approved:{title:"✨ Foto Aprovada",color:"indigo",bgColor:"bg-indigo-50",borderColor:"border-indigo-200"},pending_final_payment:{title:"🟠 Pagamento Final",color:"orange",bgColor:"bg-orange-50",borderColor:"border-orange-200"},ready_for_shipping:{title:"🚚 Pronto para Envio",color:"teal",bgColor:"bg-teal-50",borderColor:"border-teal-200"},shipped:{title:"🎉 Enviado",color:"green",bgColor:"bg-green-50",borderColor:"border-green-200"},under_review:{title:"🔍 Em Revisão",color:"red",bgColor:"bg-red-50",borderColor:"border-red-200"}};c.useEffect(()=>{const e={};Object.keys(b).forEach(t=>{e[t]=[]}),u.forEach(t=>{const a=t.order_status||"pending_payment";e[a]&&e[a].push(t)}),g(e)},[u]);const y=(e,t)=>{d(t),e.dataTransfer.effectAllowed="move"},f=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},_=(e,t)=>{if(e.preventDefault(),!s||s.order_status===t){d(null);return}if(!h(s.order_status,t)){p.error("Transição de status inválida"),d(null);return}j(s.id,t),d(null)},h=(e,t)=>{var o;return((o={pending_payment:["payment_approved","under_review"],payment_approved:["in_production","under_review"],in_production:["photo_sent","under_review"],photo_sent:["photo_approved","under_review"],photo_approved:["pending_final_payment","ready_for_shipping","under_review"],pending_final_payment:["ready_for_shipping","under_review"],ready_for_shipping:["shipped","under_review"],under_review:["pending_payment","payment_approved","in_production","photo_sent","photo_approved","pending_final_payment","ready_for_shipping"]}[e])==null?void 0:o.includes(t))||!1},j=async(e,t)=>{x(!0);try{m.patch(route("sales.update-status",e),{order_status:t},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p.success("Status atualizado com sucesso!"),g(a=>{const o={...a};Object.keys(o).forEach(i=>{o[i]=o[i].filter(D=>D.id!==e)});const n=u.find(i=>i.id===e);return n&&o[t]&&o[t].push({...n,order_status:t}),o})},onError:a=>{p.error("Erro ao atualizar status"),console.error(a)}})}catch(a){p.error("Erro ao atualizar status"),console.error(a)}finally{x(!1)}},w=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),N=e=>{const t=new Date,a=new Date(e),o=Math.floor((t-a)/(1e3*60*60));if(o<1)return"Agora";if(o<24)return`${o}h atrás`;const n=Math.floor(o/24);return n<7?`${n}d atrás`:a.toLocaleDateString("pt-BR")},C=e=>{var o;const t=e.updated_at&&new Date-new Date(e.updated_at)>1728e5,a=e.created_at&&new Date-new Date(e.created_at)>72*60*60*1e3;return r.jsxs("div",{draggable:!0,onDragStart:n=>y(n,e),className:`
                    bg-white rounded-lg border shadow-sm p-4 mb-3 cursor-move transition-all duration-200
                    hover:shadow-md hover:scale-105 transform
                    ${t?"border-l-4 border-l-yellow-500":""}
                    ${a?"border-l-4 border-l-red-500 bg-red-50":""}
                    ${(s==null?void 0:s.id)===e.id?"opacity-50 rotate-3":""}
                `,children:[r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[r.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:["#",e.unique_token]}),r.jsx("div",{className:"text-xs text-gray-500",children:N(e.updated_at)})]}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsx("div",{className:"text-gray-800 font-medium",children:e.client_name}),e.child_name&&r.jsxs("div",{className:"text-gray-600",children:["👶 ",e.child_name]}),r.jsxs("div",{className:"text-gray-600",children:["💰 ",w(e.total_amount)]}),((o=e.user)==null?void 0:o.name)&&r.jsxs("div",{className:"text-gray-500 text-xs",children:["📱 ",e.user.name]})]}),t&&r.jsx("div",{className:"mt-2 text-xs text-yellow-700 bg-yellow-100 px-2 py-1 rounded",children:"⏰ Parado há mais de 48h"}),a&&r.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"🚨 URGENTE - Mais de 72h"}),r.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[r.jsx("button",{onClick:()=>m.visit(route("sales.show",e.id)),className:"text-xs text-blue-600 hover:text-blue-800",children:"Ver detalhes →"}),r.jsxs("div",{className:"text-xs text-gray-400",children:[e.comments_count||0," 💬"]})]})]},e.id)};return r.jsxs($,{header:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"font-bold text-2xl text-gray-800 leading-tight",children:"📋 Kanban - Gestão de Pedidos"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors",children:"🔄 Atualizar"}),r.jsx("button",{onClick:()=>m.visit(route("sales.index")),className:"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"📋 Lista"})]})]}),children:[r.jsx(E,{title:"Kanban Board"}),r.jsx("div",{className:"py-6",children:r.jsx("div",{className:"max-w-full mx-auto px-4",children:r.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",style:{minHeight:"80vh"},children:Object.entries(b).map(([e,t])=>{var a,o;return r.jsxs("div",{onDragOver:f,onDrop:n=>_(n,e),className:`
                                    flex-shrink-0 w-80 ${t.bgColor} ${t.borderColor} border-2 border-dashed 
                                    rounded-lg p-4 transition-all duration-200
                                    ${s&&h(s.order_status,e)?"border-solid shadow-lg transform scale-105":""}
                                `,children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-800 text-sm",children:t.title}),r.jsx("span",{className:`
                                        text-xs px-2 py-1 rounded-full
                                        ${t.color==="yellow"?"bg-yellow-200 text-yellow-800":""}
                                        ${t.color==="green"?"bg-green-200 text-green-800":""}
                                        ${t.color==="blue"?"bg-blue-200 text-blue-800":""}
                                        ${t.color==="purple"?"bg-purple-200 text-purple-800":""}
                                        ${t.color==="indigo"?"bg-indigo-200 text-indigo-800":""}
                                        ${t.color==="orange"?"bg-orange-200 text-orange-800":""}
                                        ${t.color==="teal"?"bg-teal-200 text-teal-800":""}
                                        ${t.color==="red"?"bg-red-200 text-red-800":""}
                                    `,children:((a=l[e])==null?void 0:a.length)||0})]}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:(o=l[e])==null?void 0:o.map(n=>C(n))}),(!l[e]||l[e].length===0)&&r.jsxs("div",{className:"text-center text-gray-500 py-8 text-sm",children:[r.jsx("div",{className:"text-2xl mb-2",children:"📭"}),r.jsx("p",{children:"Nenhum pedido"})]})]},e)})})})}),v&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 flex items-center gap-3",children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),r.jsx("span",{children:"Atualizando status..."})]})})]})}export{z as default};
